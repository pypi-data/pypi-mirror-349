import"../chunks/CWj6FrbW.js";import{p as Ve,a as d,b as v,s as S,f as A,c as qe,e as t,g as e,u as O,d as Y,r as L,i as Ge}from"../chunks/CZBSCAq2.js";import{s as He}from"../chunks/BkjlwMHH.js";import{i as U}from"../chunks/DU61YhRX.js";import{e as Je,i as Ke}from"../chunks/DOEd_V7_.js";import{t as P,a as h,c as je}from"../chunks/BI1irte-.js";import{F as Qe,a as K,S as We,r as Xe,f as Ne,e as Oe}from"../chunks/eRyYcJ_-.js";import{A as se}from"../chunks/CGJrVhSX.js";import{B as Ze}from"../chunks/CBwsjfIF.js";import{R as et}from"../chunks/C-ie55WE.js";import{g as ue}from"../chunks/CqS7hfz2.js";import{D as tt}from"../chunks/gOx1Gj6P.js";import{T as $e}from"../chunks/muouQ0PZ.js";var rt=P('<div class="col-6 col-md-2">Subdivision:</div> <div class="col-4 col-md-2"><!></div>',1),st=P('<div class="row align-items-baseline"><div class="col-6 col-md-4"><h3> </h3></div> <div class="col-4 col-md-2"><!></div> <!></div>'),ot=P("<!> <!>",1),it=P("<!> <!> <!>",1),nt=P("<!> <!> <!> <!>",1),at=P("<!> <!>",1),lt=P('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),dt=P("<div></div>"),ut=P("<div></div>"),_t=P('<div class="text-center">No carriers with this selection.</div>'),ct=P('<div class="text-center">No data with this selection.</div>'),vt=P('<h2>Production</h2> <!> <div class="mt-4"><!></div>',1);function Ot(Ce,De){Ve(De,!0);let k=d(null),V=d(v([])),F=d(v([]));v([]);const Ue=["not_normalized","normalized"];let oe=d(v([])),_e=d(v([])),Q=d(v([])),q=d(v([])),W=d(v([])),X=d(v([])),ie=d(v([])),ne=v([{title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),o=d(null),ce="conversion",ae="input",g=d(null),Z=d(v([])),ee=d(v([])),G=O(()=>[...e(Z),...e(ee),...e(ie)]),M=d(v([])),R=d(v([])),te=d("not_normalized"),j=d(!1),w=d(!1),ve=d("plot"),le=d(v([])),fe=O(()=>{let r=null;return e(G).length>0&&(r=e(le).find(n=>n.technology==e(G)[0])),!r&&e(g)&&(r=e(le).find(n=>n.carrier==e(g))),r&&(r[0]||r.units)||""}),ge=d(v([])),ze=O(()=>({type:"bar",data:{datasets:e(V),labels:e(ge)},options:{responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`${ce} [${e(fe)}]`}}},plugins:{tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${r.formattedValue} ${e(fe)}`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}));async function Ee(){await ke(),Fe(),he(),Be(),z()}function pe(){t(R,e(q),!0),t(M,e(Q),!0)}function me(){switch(ce){case"conversion":return"flow_conversion_"+ae;case"storage":return"flow_storage_"+ae;case"transport":return"flow_transport";case"import_export":return"flow_"+ae;default:return null}}async function ke(){var c,a;if(t(w,!0),t(k,null),me()===null||e(o)===null){t(w,!1);return}const n=ne.flatMap(_=>{var p,s;return[Oe(e(o).solution_name,ue(_.positive,(p=e(o))==null?void 0:p.version),e(o).scenario_name,e(o).detail.system.reference_year,e(o).detail.system.interval_between_years),Oe(e(o).solution_name,ue(_.negative,(s=e(o))==null?void 0:s.version),e(o).scenario_name,e(o).detail.system.reference_year,e(o).detail.system.interval_between_years)]}),b=await Promise.all(n);(a=(c=b[0])==null?void 0:c.unit)!=null&&a.data&&t(le,b[0].unit.data,!0),t(k,b.map(_=>!_||!_.data?null:_.data),!0),t(w,!1)}function Fe(){if(e(k)==null||e(o)==null){t(F,[],!0);return}t(F,e(o).detail.system.set_carriers.sort(),!0),(e(F).length>=1&&!e(g)||!e(F).includes(e(g)))&&t(g,e(F)[0],!0),pe()}function he(){if(e(o)==null){t(W,[],!0),t(X,[],!0),t(ie,[],!0);return}t(W,Xe(Object.entries(e(o).detail.carriers_input).concat(Object.entries(e(o).detail.carriers_output)).filter(r=>e(g)&&r[1].includes(e(g))).map(r=>r[0])),!0),t(X,e(o).detail.system.set_storage_technologies.filter(r=>{var n;return((n=e(o))==null?void 0:n.detail.reference_carrier[r])==e(g)}),!0),t(ie,e(o).detail.system.set_transport_technologies.filter(r=>{var n;return((n=e(o))==null?void 0:n.detail.reference_carrier[r])==e(g)}),!0),t(Z,e(W),!0),t(ee,e(X),!0)}function Be(){t(Q,e(oe),!0),t(M,e(Q),!0),pe()}function z(){var _,p;if(e(M).length==0||e(R).length==0||!e(k)||e(k).length==0){t(V,[],!0);return}let r={},n={},b="node",c=e(q).filter(s=>!e(R).includes(s));t(V,ne.flatMap((s,u)=>{if(!s.show||!e(k))return[];r={technology:[...e(G),s.title]},n[b]=e(M);let i=[],$=e(k)[2*u];if(s.positive&&$!==null){const x=be($.data.filter(l=>l.carrier===void 0||l.carrier==e(g)),s,s.filter_by_technologies?e(G):void 0);i=Ne(x,r,n,c,e(te)=="normalized",void 0,s.positive_suffix||""),!s.subdivision&&i.length>0&&(i[0].label=s.positive_label)}let B=[];if($=e(k)[2*u+1],s.negative&&$){const x=be($.data.filter(l=>l.carrier===void 0||l.carrier==e(g)),s,s.filter_by_technologies?e(G):void 0);B=Ne(x,r,n,c,e(te)=="normalized",void 0,s.negative_suffix||"").map(l=>({...l,data:Object.fromEntries(Object.entries(l.data).map(([T,y])=>[T,-y]))})),!s.subdivision&&B.length>0&&(B[0].label=s.negative_label)}return[...i,...B]}),!0),t(ge,e(R).map(s=>s.toString()),!0);let a=e(o).solution_name.split(".");t(ve,[a[(a==null?void 0:a.length)-1],(_=e(o))==null?void 0:_.scenario_name,ue(me(),(p=e(o))==null?void 0:p.version),e(g)].join("_"),!0)}function be(r,n,b){return n.subdivision?r:Object.entries(r.reduce((c,a)=>{const _=a.node,p=a.technology;if(b&&!b.includes(p))return c;let s=Object.fromEntries(Object.entries(a).filter(([u])=>!isNaN(Number(u))).map(([u,i])=>[u,Number(i)]));return c[_]=c[_]||{technology:n.title,data:{}},c[_].data=Object.fromEntries(Object.entries(s).map(([u,i])=>[u,(i||0)+(c[_].data[u]||0)])),c},{})).map(([c,a])=>({...a.data,technology:a.technology,node:c}))}var ye=vt(),we=S(A(ye),2);Qe(we,{children:(r,n)=>{var b=at(),c=A(b);K(c,{title:"Solution Selection",children:(p,s)=>{const u=O(()=>e(w)||e(j));We(p,{solution_selected:Ee,get disabled(){return e(u)},get nodes(){return e(oe)},set nodes(i){t(oe,i,!0)},get years(){return e(q)},set years(i){t(q,i,!0)},get selected_solution(){return e(o)},set selected_solution(i){t(o,i,!0)},get edges(){return e(_e)},set edges(i){t(_e,i,!0)},get loading(){return e(j)},set loading(i){t(j,i,!0)}})}});var a=S(c,2);{var _=p=>{var s=nt(),u=A(s);K(u,{title:"Carrier Selection",children:(l,T)=>{var y=je(),f=A(y);{var C=m=>{const I=O(()=>e(F).map(D=>({label:D,value:D}))),N=O(()=>e(j)||e(w));tt(m,{label:"Carrier",get options(){return e(I)},get disabled(){return e(N)},onUpdate:()=>{he(),z()},get value(){return e(g)},set value(D){t(g,D,!0)}})};U(f,m=>{e(F).length>0&&m(C)})}h(l,y)}});var i=S(u,2);K(i,{title:"Production Component Selection",children:(l,T)=>{var y=je(),f=A(y);Je(f,17,()=>ne,Ke,(C,m,I)=>{var N=st(),D=Y(N),re=Y(D),E=Y(re,!0);L(re),L(D);var H=S(D,2),de=Y(H);$e(de,{change:z,get value(){return e(m).show},set value(J){e(m).show=J}}),L(H);var Me=S(H,2);{var Re=J=>{var Se=rt(),Pe=S(A(Se),2),Ye=Y(Pe);$e(Ye,{change:z,get value(){return e(m).subdivision},set value(Le){e(m).subdivision=Le}}),L(Pe),h(J,Se)};U(Me,J=>{e(m).show&&e(m).show_subdivision&&J(Re)})}L(N),Ge(()=>He(E,e(m).title)),h(C,N)}),h(l,y)}});var $=S(i,2);K($,{title:"Technology Selection",children:(l,T)=>{var y=ot(),f=A(y);const C=O(()=>e(j)||e(w));se(f,{label:"Conversion",get elements(){return e(W)},get disabled(){return e(C)},onUpdate:z,get value(){return e(Z)},set value(N){t(Z,N,!0)}});var m=S(f,2);const I=O(()=>e(j)||e(w));se(m,{label:"Storage",get elements(){return e(X)},get disabled(){return e(I)},onUpdate:z,get value(){return e(ee)},set value(N){t(ee,N,!0)}}),h(l,y)}});var B=S($,2);{var x=l=>{K(l,{title:"Data Selection",children:(T,y)=>{var f=it(),C=A(f);const m=O(()=>e(j)||e(w));et(C,{label:"Normalisation",options:Ue,get disabled(){return e(m)},onUpdate:z,get value(){return e(te)},set value(E){t(te,E,!0)}});var I=S(C,2);{var N=E=>{const H=O(()=>e(j)||e(w));se(E,{label:"Node",get elements(){return e(Q)},get disabled(){return e(H)},onUpdate:z,get value(){return e(M)},set value(de){t(M,de,!0)}})};U(I,E=>{E(N,!1)})}var D=S(I,2);const re=O(()=>e(j)||e(w));se(D,{label:"Year",get elements(){return e(q)},get disabled(){return e(re)},onUpdate:z,get value(){return e(R)},set value(E){t(R,E,!0)}}),h(T,f)}})};U(B,l=>{!e(w)&&e(g)!=null&&l(x)})}h(p,s)};U(a,p=>{!e(j)&&e(o)&&p(_)})}h(r,b)}});var xe=S(we,2),Te=Y(xe);{var Ae=r=>{var n=lt();h(r,n)},Ie=(r,n)=>{{var b=a=>{var _=dt();h(a,_)},c=(a,_)=>{{var p=u=>{var i=ut();h(u,i)},s=(u,i)=>{{var $=x=>{var l=_t();h(x,l)},B=(x,l)=>{{var T=f=>{var C=ct();h(f,C)},y=f=>{Ze(f,{get config(){return e(ze)},get plot_name(){return e(ve)}})};U(x,f=>{e(V).length==0?f(T):f(y,!1)},l)}};U(u,x=>{e(F).length==0?x($):x(B,!1)},i)}};U(a,u=>{e(V)==null?u(p):u(s,!1)},_)}};U(r,a=>{e(o)==null?a(b):a(c,!1)},n)}};U(Te,r=>{e(j)||e(w)?r(Ae):r(Ie,!1)})}L(xe),h(Ce,ye),qe()}export{Ot as component};
