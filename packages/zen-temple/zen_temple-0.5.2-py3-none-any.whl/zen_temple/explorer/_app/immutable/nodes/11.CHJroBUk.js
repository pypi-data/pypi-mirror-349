import"../chunks/CWj6FrbW.js";import{p as qe,a as d,b as v,s as j,f as A,c as Ge,e as t,g as e,u as $,d as L,r as V,i as He}from"../chunks/CZBSCAq2.js";import{s as Je}from"../chunks/BkjlwMHH.js";import{i as U}from"../chunks/DU61YhRX.js";import{e as Ke,i as Qe}from"../chunks/B0glBihA.js";import{t as P,a as b,c as Pe}from"../chunks/BI1irte-.js";import{F as We,a as K,S as Xe,r as Oe,f as Ne,e as $e}from"../chunks/CGcYVaKC.js";import{A as ie}from"../chunks/DSh3a7Z0.js";import{B as Ze}from"../chunks/C4gHG6hG.js";import{R as et}from"../chunks/DYyI0-8l.js";import{g as Q}from"../chunks/CqS7hfz2.js";import{D as tt}from"../chunks/CPDAXu9W.js";import{T as Ce}from"../chunks/muouQ0PZ.js";var rt=P('<div class="col-6 col-md-2">Subdivision:</div> <div class="col-4 col-md-2"><!></div>',1),st=P('<div class="row align-items-baseline"><div class="col-6 col-md-4"><h3> </h3></div> <div class="col-4 col-md-2"><!></div> <!></div>'),it=P("<!> <!>",1),at=P("<!> <!> <!>",1),ot=P("<!> <!> <!> <!>",1),nt=P("<!> <!>",1),lt=P('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),dt=P("<div></div>"),ut=P("<div></div>"),ct=P('<div class="text-center">No carriers with this selection.</div>'),_t=P('<div class="text-center">No data with this selection.</div>'),vt=P('<h2>Production</h2> <!> <div class="mt-4"><!></div>',1);function Nt(De,ke){qe(ke,!0);let F=d(null),M=d(v([])),ae=d(v([])),w=d(v([]));v([]);const Ue=["not_normalized","normalized"];let oe=d(v([])),_e=d(v([])),W=d(v([])),q=d(v([])),X=d(v([])),Z=d(v([])),ne=d(v([])),le=v([{title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),s=d(null),de="conversion",ue="input",p=d(null),ee=d(v([])),te=d(v([])),G=$(()=>[...e(ee),...e(te),...e(ne)]),R=d(v([])),Y=d(v([])),re=d("not_normalized"),O=d(!1),x=d(!1),ve=d("plot"),fe=d(v([])),ge=$(()=>{let r=null;return e(G).length>0&&(r=e(ae).find(o=>o.technology==e(G)[0])),!r&&e(p)&&(r=e(ae).find(o=>o.carrier==e(p))),r&&(r[0]||r.unit)||""}),ze=$(()=>({type:"bar",data:{datasets:e(M),labels:e(fe)},options:{responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`${de} [${e(ge)}]`}}},plugins:{tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${r.formattedValue} ${e(ge)}`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}));async function Ee(){await Fe(),Be(),he(),Te(),z()}function pe(){t(Y,e(q),!0),t(R,e(W),!0)}function me(){switch(de){case"conversion":return"flow_conversion_"+ue;case"storage":return"flow_storage_"+ue;case"transport":return"flow_transport";case"import_export":return"flow_"+ue;default:return null}}async function Fe(){var _,n;if(t(x,!0),t(F,null),me()===null||e(s)===null){t(x,!1);return}const o=le.flatMap(c=>{var m,i;return[$e(e(s).solution_name,Q(c.positive,(m=e(s))==null?void 0:m.version),e(s).scenario_name,e(s).detail.system.reference_year,e(s).detail.system.interval_between_years),$e(e(s).solution_name,Q(c.negative,(i=e(s))==null?void 0:i.version),e(s).scenario_name,e(s).detail.system.reference_year,e(s).detail.system.interval_between_years)]}),f=await Promise.all(o);(n=(_=f[0])==null?void 0:_.unit)!=null&&n.data&&t(ae,f[0].unit.data,!0),t(F,f.map(c=>!c||!c.data?null:c.data),!0),t(x,!1)}function Be(){var r,o;if(e(F)==null||e(s)==null){t(w,[],!0);return}switch(t(M,[],!0),de){case Q("import_export",(r=e(s))==null?void 0:r.version):t(w,e(s).detail.carriers_export,!0);break;case Q("conversion",(o=e(s))==null?void 0:o.version):let f;f=e(s).detail.carriers_input,t(w,Oe(Object.values(f).flat()),!0);break;default:t(w,e(s).detail.system.set_carriers,!0)}(e(w).length>=1&&!e(p)||!e(w).includes(e(p)))&&t(p,e(w)[0],!0),pe()}function he(){if(e(s)==null){t(X,[],!0),t(Z,[],!0),t(ne,[],!0);return}t(X,Oe(Object.entries(e(s).detail.carriers_input).concat(Object.entries(e(s).detail.carriers_output)).filter(r=>e(p)&&r[1].includes(e(p))).map(r=>r[0])),!0),t(Z,e(s).detail.system.set_storage_technologies.filter(r=>{var o;return((o=e(s))==null?void 0:o.detail.reference_carrier[r])==e(p)}),!0),t(ne,e(s).detail.system.set_transport_technologies.filter(r=>{var o;return((o=e(s))==null?void 0:o.detail.reference_carrier[r])==e(p)}),!0),t(ee,e(X),!0),t(te,e(Z),!0)}function Te(){t(W,e(oe),!0),t(R,e(W),!0),pe()}function z(){var c,m;if(e(R).length==0||e(Y).length==0||!e(F)||e(F).length==0){t(M,[],!0);return}let r={},o={},f="node",_=e(q).filter(i=>!e(Y).includes(i));t(M,le.flatMap((i,u)=>{if(!i.show||!e(F))return null;r={technology:[...e(G),i.title]},o[f]=e(R);let a=[],C=e(F)[2*u];if(i.positive&&C!==null){const S=be(C.data.filter(l=>l.carrier===void 0||l.carrier==e(p)),i,i.filter_by_technologies?e(G):void 0);a=Ne(S,r,o,_,e(re)=="normalized",void 0,i.positive_suffix||""),!i.subdivision&&a.length>0&&(a[0].label=i.positive_label)}let B=[];if(C=e(F)[2*u+1],i.negative&&C){const S=be(C.data.filter(l=>l.carrier===void 0||l.carrier==e(p)),i,i.filter_by_technologies?e(G):void 0);B=Ne(S,r,o,_,e(re)=="normalized",void 0,i.negative_suffix||"").map(l=>({...l,data:Object.fromEntries(Object.entries(l.data).map(([T,y])=>[T,-y]))})),!i.subdivision&&B.length>0&&(B[0].label=i.negative_label)}return[...a,...B]}),!0),t(fe,e(Y).map(i=>i.toString()),!0);let n=e(s).solution_name.split(".");t(ve,[n[(n==null?void 0:n.length)-1],(c=e(s))==null?void 0:c.scenario_name,Q(me(),(m=e(s))==null?void 0:m.version),e(p)].join("_"),!0)}function be(r,o,f){return o.subdivision?r:Object.entries(r.reduce((_,n)=>{const c=n.node,m=n.technology;if(f&&!f.includes(m))return _;let i=Object.fromEntries(Object.entries(n).filter(([u])=>!isNaN(Number(u))).map(([u,a])=>[u,Number(a)]));return _[c]=_[c]||{technology:o.title,data:{}},_[c].data=Object.fromEntries(Object.entries(i).map(([u,a])=>[u,(a||0)+(_[c].data[u]||0)])),_},{})).map(([_,n])=>({...n.data,technology:n.technology,node:_}))}var ye=vt(),we=j(A(ye),2);We(we,{children:(r,o)=>{var f=nt(),_=A(f);K(_,{title:"Solution Selection",children:(m,i)=>{const u=$(()=>e(x)||e(O));Xe(m,{solution_selected:Ee,get disabled(){return e(u)},get carriers(){return e(w)},set carriers(a){t(w,a,!0)},get nodes(){return e(oe)},set nodes(a){t(oe,a,!0)},get years(){return e(q)},set years(a){t(q,a,!0)},get selected_solution(){return e(s)},set selected_solution(a){t(s,a,!0)},get edges(){return e(_e)},set edges(a){t(_e,a,!0)},get loading(){return e(O)},set loading(a){t(O,a,!0)}})}});var n=j(_,2);{var c=m=>{var i=ot(),u=A(i);K(u,{title:"Carrier Selection",children:(l,T)=>{var y=Pe(),g=A(y);{var D=h=>{const I=$(()=>e(w).map(k=>({label:k,value:k}))),N=$(()=>e(O)||e(x));tt(h,{label:"Carrier",get options(){return e(I)},get disabled(){return e(N)},onUpdate:()=>{he(),z()},get value(){return e(p)},set value(k){t(p,k,!0)}})};U(g,h=>{e(w).length>0&&h(D)})}b(l,y)}});var a=j(u,2);K(a,{title:"Production Component Selection",children:(l,T)=>{var y=Pe(),g=A(y);Ke(g,17,()=>le,Qe,(D,h,I)=>{var N=st(),k=L(N),se=L(k),E=L(se,!0);V(se),V(k);var H=j(k,2),ce=L(H);Ce(ce,{change:z,get value(){return e(h).show},set value(J){e(h).show=J}}),V(H);var Re=j(H,2);{var Ye=J=>{var Se=rt(),je=j(A(Se),2),Le=L(je);Ce(Le,{change:z,get value(){return e(h).subdivision},set value(Ve){e(h).subdivision=Ve}}),V(je),b(J,Se)};U(Re,J=>{e(h).show&&e(h).show_subdivision&&J(Ye)})}V(N),He(()=>Je(E,e(h).title)),b(D,N)}),b(l,y)}});var C=j(a,2);K(C,{title:"Technology Selection",children:(l,T)=>{var y=it(),g=A(y);const D=$(()=>e(O)||e(x));ie(g,{label:"Conversion",get elements(){return e(X)},get disabled(){return e(D)},onUpdate:z,get value(){return e(ee)},set value(N){t(ee,N,!0)}});var h=j(g,2);const I=$(()=>e(O)||e(x));ie(h,{label:"Storage",get elements(){return e(Z)},get disabled(){return e(I)},onUpdate:z,get value(){return e(te)},set value(N){t(te,N,!0)}}),b(l,y)}});var B=j(C,2);{var S=l=>{K(l,{title:"Data Selection",children:(T,y)=>{var g=at(),D=A(g);const h=$(()=>e(O)||e(x));et(D,{label:"Normalisation",options:Ue,get disabled(){return e(h)},onUpdate:z,get value(){return e(re)},set value(E){t(re,E,!0)}});var I=j(D,2);{var N=E=>{const H=$(()=>e(O)||e(x));ie(E,{label:"Node",get elements(){return e(W)},get disabled(){return e(H)},onUpdate:z,get value(){return e(R)},set value(ce){t(R,ce,!0)}})};U(I,E=>{E(N,!1)})}var k=j(I,2);const se=$(()=>e(O)||e(x));ie(k,{label:"Year",get elements(){return e(q)},get disabled(){return e(se)},onUpdate:z,get value(){return e(Y)},set value(E){t(Y,E,!0)}}),b(T,g)}})};U(B,l=>{!e(x)&&e(p)!=null&&l(S)})}b(m,i)};U(n,m=>{!e(O)&&e(s)&&m(c)})}b(r,f)}});var xe=j(we,2),Ae=L(xe);{var Ie=r=>{var o=lt();b(r,o)},Me=(r,o)=>{{var f=n=>{var c=dt();b(n,c)},_=(n,c)=>{{var m=u=>{var a=ut();b(u,a)},i=(u,a)=>{{var C=S=>{var l=ct();b(S,l)},B=(S,l)=>{{var T=g=>{var D=_t();b(g,D)},y=g=>{Ze(g,{get config(){return e(ze)},get plot_name(){return e(ve)}})};U(S,g=>{e(M).length==0?g(T):g(y,!1)},l)}};U(u,S=>{e(w).length==0?S(C):S(B,!1)},a)}};U(n,u=>{e(M)==null?u(m):u(i,!1)},c)}};U(r,n=>{e(s)==null?n(f):n(_,!1)},o)}};U(Ae,r=>{e(O)||e(x)?r(Ie):r(Me,!1)})}V(xe),b(De,ye),Ge()}export{Nt as component};
