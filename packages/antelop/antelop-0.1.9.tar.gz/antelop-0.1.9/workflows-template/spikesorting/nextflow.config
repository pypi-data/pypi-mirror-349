profiles {

    standard {

        includeConfig '../antelop-nf.config'

        process {
            withName: QuerySessions {
                container = 'antelop-python.sif'
                clusterOptions = '-c 1 -t 10 -p cpu'
                errorStrategy = {
                    sleep( task.attempt * 150 as long )
                    return 'retry'
                    }
                maxRetries = 1
                }
        }

        process {
            withName: DownloadData {
                container = 'antelop-python.sif'
                clusterOptions = '-c 1 -t 30 -p cpu'
                errorStrategy = { (task.attempt <= 5) ? 'retry' : 'ignore' }
                }
        }

        process {
            withName: ConvertRec {
                container = 'spikeinterface.sif'
                clusterOptions = '-c 1 -t 60 -p cpu --mem=20G'
                errorStrategy = { (task.attempt <= 2) ? 'retry' : 'ignore' }
                }
        }

        process {
            withName: PreProcess {
                container = 'spikeinterface.sif'
                clusterOptions = '-c 4 -t 60 -p cpu --mem=10G'
                errorStrategy = { (task.attempt <= 2) ? 'retry' : 'ignore' }
                }
        }

        process {
            withName: MountainSort5 {
                container = 'mountainsort5.sif'
                clusterOptions = '-c 4 -t 120 -p cpu --mem=50G'
                errorStrategy = { (task.attempt <= 2) ? 'retry' : 'ignore' }
                }
        }

        process {
            withName: PyKiloSort {
                container = 'pykilosort.sif'
                clusterOptions = '-t 120 -p gpu --gpus=1 --mem=31G'
                errorStrategy = { (task.attempt <= 2) ? 'retry' : 'ignore' }
                maxForks = 8
                }
        }

        process {
            withName: SpykingCircus2 {
                container = 'spikeinterface.sif'
                clusterOptions = '-c 4 -t 120 -p cpu --mem=40G'
                errorStrategy = { (task.attempt <= 2) ? 'retry' : 'ignore' }
                }
        }

        process {
            withName: AgreementMatch {
                container = 'spikeinterface.sif'
                clusterOptions = '-c 4 -t 60 -p cpu --mem=20G'
                errorStrategy = { (task.attempt <= 2) ? 'retry' : 'ignore' }
                }
        }

        process {
            withName: ExtractWaveforms {
                container = 'spikeinterface.sif'
                clusterOptions = '-c 4 -t 120 -p cpu --mem=40G'
                errorStrategy = { (task.attempt <= 2) ? 'retry' : 'ignore' }
                }
        }

        process {
            withName: ExportPhy {
                container = 'spikeinterface.sif'
                clusterOptions = '-c 4 -t 60 -p cpu --mem=20G'
                errorStrategy = { (task.attempt <= 2) ? 'retry' : 'ignore' }
                }
        }

        process {
            withName: UploadData {
                container = 'antelop-python.sif'
                clusterOptions = '-c 2 -t 30 -p cpu --mem=10G'
                errorStrategy = { (task.attempt <= 2) ? 'retry' : 'ignore' }
                }
        }
    }

    local {
        process.executor = 'local'
    }

}
