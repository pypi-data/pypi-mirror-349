{% from "partials/_structured_data_view.html" import render_value %}

<article id="results-display-content" x-data="{ viewMode: 'structured' }">
    <header class="grid">
        <h5 style="margin-bottom: 0;">Execution Result</h5>
        <div style="text-align: right;">
            <button role="button" class="outline contrast" @click="viewMode = 'structured'" :aria-pressed="viewMode === 'structured'">Structured</button>
            <button role="button" class="outline contrast" @click="viewMode = 'json'" :aria-pressed="viewMode === 'json'">Raw JSON</button>
        </div>
    </header>

    <div x-show="viewMode === 'json'">
        {# Check for the new result_raw_json variable first #}
        {% if result_raw_json is defined %}
            <pre><code class="language-json" style="word-break: break-all; white-space: pre-wrap;">{{ result_raw_json }}</code></pre>
        {# Fallback for old context or if result was an error string from backend before formatting #}
        {% elif result is string %}
            <pre><code class="language-plaintext" style="word-break: break-all; white-space: pre-wrap;">{{ result }}</code></pre>
        {% elif result %}
            {# Fallback if result_raw_json is somehow not provided but result (dict) is #}
            <pre><code class="language-json" style="word-break: break-all; white-space: pre-wrap;">{{ result | tojson(indent=2) }}</code></pre>
        {% else %}
            <p>No results to display yet.</p>
        {% endif %}
    </div>

    <div x-show="viewMode === 'structured'">
        {% if result is string %}
            <p class="error" style="white-space: pre-wrap;">{{ result }}</p>
        {% elif result is mapping %}
            {{ render_value(result) }}
        {% elif result %}
             <p>Structured view not available for this result type (not a dictionary).</p>
             <pre><code class="language-json" style="word-break: break-all; white-space: pre-wrap;">{{ result | tojson(indent=2) }}</code></pre>
        {% else %}
            <p>No results to display yet.</p>
        {% endif %}
    </div>
</article>