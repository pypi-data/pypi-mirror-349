import{v as H,w as le,c as re}from"./runtime-dom.esm-bundler.DChKj6X8.js";import{f as ie,e as oe}from"./deployments._Dzuk3-5.js";import{f as se,b as ue}from"./integrations.CUprebZ9.js";import{c as pe,g as de}from"./experiments.E3MiUWYx.js";import{c as ve}from"./plans.CKfMLPs_.js";import{f as $,b as ee}from"./environments.zePoF_Ox.js";import{f as fe}from"./deployments._oxKRVlY.js";import{I as me}from"./IntegrationVendorIcon.DaK4Ze8p.js";import{F as ce}from"./FilterableSelect.C271uK1S.js";/* empty css                     */import{_ as ye}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{u as B}from"./index.CwJxcYEt.js";import{d as he,c as I,a as l,b as c,w as j,l as ge,i as G,e as Z,n as be,F as we,k as Ee,r as d,p as _e,g as Ve,o as Se,L as xe,h as _,j as Ie}from"./runtime-core.esm-bundler.Y6RLDZTT.js";import"./user.BEEfOshe.js";import"./user.Bg1Nd46A.js";import"./index.BSdFiPHn.js";import"./loader.BQDlK3Tc.js";import"./notifications.NSMm1_5U.js";import"./experiments.rwiqw3d6.js";import"./objects.CrQdKsRW.js";import"./SlackLogo.DsMAXqZJ.js";import"./HoneycombMark.CTdYfWPx.js";import"./GoogleCloudLogo.D_PfFuNt.js";import"./ReliablyRLogo.BeZqNTy5.js";import"./index.DUHDLdXK.js";/* empty css                        */var T={},te;function ke(){if(te)return T;te=1;var C=T.__assign||function(){return C=Object.assign||function(t){for(var i,s=1,p=arguments.length;s<p;s++){i=arguments[s];for(var v in i)Object.prototype.hasOwnProperty.call(i,v)&&(t[v]=i[v])}return t},C.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.isValidCron=void 0;var e=function(t){return/^\d+$/.test(t)?Number(t):NaN},h=function(t){return t==="*"},n=function(t){return t==="?"},g=function(t,i,s){return t>=i&&t<=s},V=function(t,i,s){var p=t.split("-");switch(p.length){case 1:return h(t)||g(e(t),i,s);case 2:var v=p.map(function(E){return e(E)}),m=v[0],b=v[1];return m<=b&&g(m,i,s)&&g(b,i,s);default:return!1}},o=function(t){return t===void 0||t.search(/[^\d]/)===-1&&e(t)>0},f=function(t,i,s){if(t.search(/[^\d-,\/*]/)!==-1)return!1;var p=t.split(",");return p.every(function(v){var m=v.split("/");if(v.trim().endsWith("/")||m.length>2)return!1;var b=m[0],E=m[1];return V(b,i,s)&&o(E)})},k=function(t){return f(t,0,59)},S=function(t){return f(t,0,59)},F=function(t){return f(t,0,23)},N=function(t,i){return i&&n(t)||f(t,1,31)},D={jan:"1",feb:"2",mar:"3",apr:"4",may:"5",jun:"6",jul:"7",aug:"8",sep:"9",oct:"10",nov:"11",dec:"12"},y=function(t,i){if(t.search(/\/[a-zA-Z]/)!==-1)return!1;if(i){var s=t.toLowerCase().replace(/[a-z]{3}/g,function(p){return D[p]===void 0?p:D[p]});return f(s,1,12)}return f(t,1,12)},x={sun:"0",mon:"1",tue:"2",wed:"3",thu:"4",fri:"5",sat:"6"},P=function(t,i,s,p){if(s&&n(t))return!0;if(!s&&n(t)||t.search(/\/[a-zA-Z]/)!==-1)return!1;if(i){var v=t.toLowerCase().replace(/[a-z]{3}/g,function(m){return x[m]===void 0?m:x[m]});return f(v,0,p?7:6)}return f(t,0,p?7:6)},q=function(t,i,s){return!(s&&n(t)&&n(i))},A=function(t){return t.trim().split(/\s+/)},L={alias:!1,seconds:!1,allowBlankDay:!1,allowSevenAsSunday:!1};return T.isValidCron=function(t,i){i=C(C({},L),i);var s=A(t);if(s.length>(i.seconds?6:5)||s.length<5)return!1;var p=[];if(s.length===6){var v=s.shift();v&&p.push(k(v))}var m=s[0],b=s[1],E=s[2],M=s[3],W=s[4];return p.push(S(m)),p.push(F(b)),p.push(N(E,i.allowBlankDay)),p.push(y(M,i.alias)),p.push(P(W,i.alias,i.allowBlankDay,i.allowSevenAsSunday)),p.push(q(E,W,i.allowBlankDay)),p.every(Boolean)},T}var De=ke();const Ce=he({__name:"PlanForm",setup(C,{expose:e}){e();const h=d(""),n=d(null),g=d({status:!1,value:""}),V=d(""),o=d(void 0),f=d(""),k=async()=>{const r=p.value.find(a=>a.val===V.value);r&&(o.value={name:r.label,id:r.val,type:r.type}),F.value.length===0&&await N()};_e(V,()=>{k()});const S=d(""),F=d([]);async function N(){let r=[];await $(1);let a=B(ee);if(a.value.environments.forEach(w=>{r.push({label:w.name,val:w.id})}),a.value.total>10){let w=Math.floor(a.value.total/10);a.value.total%10>0&&w++;let R=[];for(var u=2;u<=w;u++)R.push(u);for(const ae of R)await $(ae),B(ee).value.environments.forEach(X=>{r.push({label:X.name,val:X.id})})}F.value=[...r]}const D=d(""),y=d(""),x=d(!0),P=d(!1),q=d([]);function A(){h.value!==g.value.value&&(g.value={status:!1,value:""})}function L(r){(h.value===""||h.value===r.label||g.value.status===!0)&&(h.value=r.label,g.value={status:!0,value:r.label})}const t=r=>{y.value=r},i=()=>{y.value===""||y.value==="now"||De.isValidCron(y.value)?x.value=!0:x.value=!1},s=Ve(()=>h.value===""||V.value===""||D.value.length===0||y.value===""),p=d([]),v=d(0),m=d(1),b=async()=>{await ie(m.value);let r=B(oe);v.value=r.value.total,r.value.deployments.forEach(a=>{p.value.push({label:`${fe(a.definition.type)} ${a.name}`,val:a.id,type:a.definition.type})}),m.value++},E=async()=>{for(let r=1;10*r<v.value;r++)await b()},M=()=>{let r=window.location,a=new URLSearchParams(r.search);if(a.has("exp")){const u=a.get("exp");D.value=u;const w=W.value.find(R=>R.val===u);w&&(h.value=w.label)}if(a.has("s")){let u=a.get("s");u!==null&&(u==="now"?y.value="now":y.value=u.replaceAll("_"," "))}if(a.has("a")){let u=a.get("a");u!==null&&u==="true"&&(P.value=!0)}if(a.has("d")){let u=a.get("d");u!==null&&(V.value=u,k())}if(a.has("envid")){const u=a.get("envid");u!==null&&u!=="null"&&(S.value=u)}if(a.has("envgh")){const u=a.get("envgh");u!==null&&u!=="null"&&(f.value=u)}if(a.has("int")){let u=a.get("int");if(u!==""){let w=u.split(",");q.value=[...w]}}},W=d([]),Y=async()=>{await pe(),B(de).value.forEach(a=>{W.value.push({label:a.title,val:a.id})})},Q=d([]),O=d(0),U=d(1),z=async()=>{await se(U.value);let r=B(ue);O.value=r.value.total,r.value.integrations.forEach(a=>{a.vendor=="reliably"&&(a.provider=="assistant"||a.provider=="snapshot"||a.provider=="notification")||Q.value.push({name:a.name,provider:a.provider,id:a.id,vendor:a.vendor})}),U.value++},J=async()=>{for(let r=1;10*r<O.value;r++)await z()},ne=async()=>{let r={type:"now"};y.value!=="now"&&(r={type:"cron",pattern:y.value,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}),P.value&&(r.via_agent=!0);let a={title:h.value,environment:null,deployment:{deployment_id:o.value?.id,deployment_type:o.value?.type},schedule:r,experiments:[D.value],integrations:q.value};o.value.type==="github"?(a.environment={provider:"github",name:f.value},S.value!==""&&(a.environment.id=S.value)):(o.value.type==="reliably_cloud"||o.value.type==="reliably_cli"||o.value.type==="container"||o.value.type==="k8s_job")&&S.value!==""&&(a.environment={provider:"reliably_cloud",id:S.value}),ve(a)};Se(async()=>{await b(),await E(),await z(),await J(),await Y(),M(),xe(()=>{n.value.focus()})});const K={planTitle:h,planTitleInput:n,isTitleSetAutomatically:g,planDeploymentId:V,targetDeployment:o,planEnvName:f,onPlanDeploymentChange:k,planEnvId:S,environmentsList:F,getEnvironments:N,planExperiments:D,planSchedule:y,isCronValid:x,planViaAgent:P,planIntegrations:q,handleTitleBlur:A,handleExperimentsChange:L,setSchedule:t,onScheduleBlur:i,isSubmitDisabled:s,deploys:p,totalDeploys:v,deploysPage:m,getDeployments:b,getMoreDeployments:E,populateFromParams:M,exps:W,getExperiments:Y,ints:Q,totalInts:O,intsPage:U,getIntegrations:z,getMoreIntegrations:J,proceed:ne,IntegrationVendorIcon:me,FilterableSelect:ce};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),We={class:"planForm form"},Te={class:"inputWrapper"},Fe={class:"inputWrapper"},Pe={key:1},qe={class:"inputWrapper"},Be={key:0,class:"inputWrapper"},Ne={class:"inputWrapper"},Me={class:"noLegend"},Re={key:0,class:"inputWrapper__help"},je={class:"inputWrapper__help"},Ae={class:"planForm__integrations inputWrapper"},Le={key:0},Oe=["index"],Ue=["value","id","name"],ze=["for"],He={key:1},Ge={class:"inputWrapper"},Ze=["disabled"];function Ye(C,e,h,n,g,V){return _(),I("form",We,[l("fieldset",null,[l("div",Te,[e[12]||(e[12]=l("label",{for:"planTitle"},[c(" Plan title "),l("span",{class:"required"},"Required")],-1)),j(l("input",{type:"text",name:"planTitle",id:"planTitle","onUpdate:modelValue":e[0]||(e[0]=o=>n.planTitle=o),ref:"planTitleInput",required:"","data-form-type":"other",onBlur:n.handleTitleBlur},null,544),[[H,n.planTitle]]),e[13]||(e[13]=l("p",{class:"inputWrapper__help"}," If left empty, the title of the experiment will be used ",-1))]),l("div",Fe,[n.deploys.length?(_(),ge(n.FilterableSelect,{key:0,options:n.deploys,modelValue:n.planDeploymentId,"onUpdate:modelValue":e[1]||(e[1]=o=>n.planDeploymentId=o),label:"Deployment","is-required":!0,"default-message":"Select a deployment"},null,8,["options","modelValue"])):(_(),I("p",Pe,e[14]||(e[14]=[c(" You don't seem to have created Deployments yet. Deployments are required to run plans. "),l("a",{href:"/deployments/new/"},"Create your first deployment",-1),c(". ")])))]),l("div",qe,[G(n.FilterableSelect,{options:n.environmentsList,modelValue:n.planEnvId,"onUpdate:modelValue":e[2]||(e[2]=o=>n.planEnvId=o),label:"Reliably Environment","allow-empty":!0},null,8,["options","modelValue"]),e[15]||(e[15]=l("p",{class:"inputWrapper__help"}," Name of the Reliably Environment where your secrets and variables are stored ",-1))]),n.targetDeployment?.type==="github"?(_(),I("div",Be,[e[16]||(e[16]=l("label",{for:"GitHubEnv"},[c(" GitHub environment name "),l("span",{class:"required"},"Required")],-1)),j(l("input",{type:"text",name:"GitHubEnv",id:"GitHubEnv","onUpdate:modelValue":e[3]||(e[3]=o=>n.planEnvName=o),required:""},null,512),[[H,n.planEnvName]]),e[17]||(e[17]=l("p",{class:"inputWrapper__help"}," Name of the GitHub Environment where your secrets are stored ",-1))])):Z("",!0),l("div",Ne,[G(n.FilterableSelect,{options:n.exps,modelValue:n.planExperiments,"onUpdate:modelValue":e[4]||(e[4]=o=>n.planExperiments=o),label:"Experiment","is-required":!0,"default-message":"Select an experiment",onEmitObject:n.handleExperimentsChange},null,8,["options","modelValue"])])]),l("fieldset",Me,[l("div",{class:be(["inputWrapper",{"inputWrapper--error":!n.isCronValid}])},[e[23]||(e[23]=l("label",{for:"schedule"},[c(" Schedule "),l("span",{class:"required"},"Required")],-1)),j(l("input",{type:"text",name:"schedule",id:"schedule","onUpdate:modelValue":e[5]||(e[5]=o=>n.planSchedule=o),onBlur:n.onScheduleBlur,required:""},null,544),[[H,n.planSchedule]]),n.isCronValid?Z("",!0):(_(),I("p",Re," Schedule is not valid CRON. ")),e[24]||(e[24]=l("p",{class:"inputWrapper__help"},[c(" Schedules are specified using the "),l("a",{href:"https://man7.org/linux/man-pages/man5/crontab.5.html",target:"_blank",rel:"noopener noreferer"},"unix-cron"),c(" format. Use "),l("strong",null,"now"),c(" to run your experiments as soon as possible. ")],-1)),l("p",je,[e[18]||(e[18]=c(" Shortcuts: ")),l("span",{role:"button",onClick:e[6]||(e[6]=o=>n.setSchedule("*/5 * * * *"))}," Every 5 minutes"),e[19]||(e[19]=c(", ")),l("span",{role:"button",onClick:e[7]||(e[7]=o=>n.setSchedule("0 */1 * * *"))}," Every hour"),e[20]||(e[20]=c(", ")),l("span",{role:"button",onClick:e[8]||(e[8]=o=>n.setSchedule("0 9 */1 * *"))}," Every day at 9:00"),e[21]||(e[21]=c(", ")),l("span",{role:"button",onClick:e[9]||(e[9]=o=>n.setSchedule("0 9 1 * *"))}," On the first day of every month at 9:00"),e[22]||(e[22]=c(". "))])],2),Z("",!0)]),l("fieldset",null,[e[27]||(e[27]=l("legend",null,"Integrations",-1)),l("div",Ae,[n.ints.length>0?(_(),I("div",Le,[(_(!0),I(we,null,Ee(n.ints,(o,f)=>(_(),I("div",{index:f,class:"inputWrapper inputWrapper--tick"},[l("div",null,[j(l("input",{type:"checkbox",value:o.id,id:`int-${f}`,name:`int-${f}`,"onUpdate:modelValue":e[11]||(e[11]=k=>n.planIntegrations=k)},null,8,Ue),[[re,n.planIntegrations]]),l("label",{for:`int-${f}`},[G(n.IntegrationVendorIcon,{vendor:o.vendor},null,8,["vendor"]),c(" "+Ie(o.name),1)],8,ze)])],8,Oe))),256))])):(_(),I("p",He,"You don't have any active integrations"))]),l("div",Ge,[l("button",{onClick:le(n.proceed,["prevent"]),disabled:n.isSubmitDisabled,class:"button button--primary"}," Create plan ",8,Ze)])])])}const _t=ye(Ce,[["render",Ye],["__scopeId","data-v-42d2672e"]]);export{_t as default};
