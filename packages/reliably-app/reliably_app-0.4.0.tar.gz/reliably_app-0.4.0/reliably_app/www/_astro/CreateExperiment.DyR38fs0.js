import{w as d,v as G}from"./runtime-dom.esm-bundler.DChKj6X8.js";import{t as ae,f as le,a as re}from"./templates.C0LiUYsE.js";import{i as se}from"./experiments.E3MiUWYx.js";import{C as ue}from"./CreateExperimentField.BarnZA-o.js";import{E as me}from"./ExperimentContributions.DYiQPL7e.js";import"./dayjs.min.xlbmdZiw.js";import"./duration.BGVtNWJ9.js";import{_ as pe}from"./_plugin-vue_export-helper.DlAUqK2U.js";/* empty css                        */import{E as de}from"./ExperimentTags.nDPInRUa.js";import{L as ce}from"./LoadingPlaceholder.BoWrztnb.js";import{N as fe}from"./NoData.CWOJbPLy.js";import{M as ve}from"./ModalWindow.Go1bYN-e.js";import{J as ge}from"./JsonViewer.CMLqmGhq.js";/* empty css                        */import{h as xe}from"./objects.CrQdKsRW.js";/* empty css                        */import{u as _e}from"./index.CwJxcYEt.js";import{d as be,c as p,l as k,a as n,j as U,w as H,b as M,F as z,k as he,e as K,i as y,m as Q,r,g as Ee,o as ye,h as s}from"./runtime-core.esm-bundler.Y6RLDZTT.js";import"./user.BEEfOshe.js";import"./user.Bg1Nd46A.js";import"./index.BSdFiPHn.js";import"./loader.BQDlK3Tc.js";import"./notifications.NSMm1_5U.js";import"./experiments.rwiqw3d6.js";import"./FilterableSelect.C271uK1S.js";import"./index.DUHDLdXK.js";/* empty css                        */import"./snapshots.Bn5DFrP3.js";/* empty css                        */import"./PlusIcon.CLPjCzPo.js";import"./MinusIcon.BnPCOBQF.js";/* empty css                        *//* empty css                       *//* empty css                        */import"./CloseIcon.DLOPA8gH.js";/* empty css                        */import"./js-yaml.C-pQuU5J.js";/* empty css                        */import"./preload-helper.CLcXU_4U.js";const Ce=be({__name:"CreateExperiment",setup(X,{expose:o}){o();const b=r(!0),e=r(void 0),c=r(null),m=_e(ae),i=r(null);function v(){let t=window.location,l=new URLSearchParams(t.search);l.has("id")?e.value=l.get("id"):l.has("activity")&&(c.value=l.get("activity"))}async function W(){e.value?await le(e.value):c.value&&await re(c.value)}function j(){m.value!==null&&(i.value=m.value.manifest.spec.template)}const N=()=>{let t="Template · Reliably";m.value!==void 0&&m.value!==null&&(t=`Create experiment from template ${m.value.manifest.metadata.name} · Reliably`),document.title=t},C=r(!1),T=r("");function B(){C.value=!C.value}function L(){i.value&&(T.value=i.value.title)}function Y(){i.value!==null&&(i.value.title=T.value,B())}const w=r(!1),D=r("");function P(){w.value=!w.value}function q(){i.value&&(D.value=i.value.description)}function Z(){i.value!==null&&(i.value.description=D.value,P())}function $(t,l,u,g,x,_){if(i.value?.configuration!==void 0){const E=i.value.configuration[t];if(xe(E,"type")&&E.type==="env")if(u!=null)i.value.configuration[t].default=u;else{const a=i.value.configuration[t].env_var_type;a==="int"||a==="float"||a==="bool"?delete i.value.configuration[t].default:a==="str"?i.value.configuration[t].default="":a==="json"?i.value.configuration[t].default=null:delete i.value.configuration[t].default}else{let a="";l==="string"?a="str":l==="integer"?a="int":l==="float"?a="float":l==="boolean"?a="bool":l==="object"&&(a="json"),u!=null?i.value.configuration[t]={key:t.toUpperCase(),type:"env",env_var_type:a,default:u}:a==="int"||a==="float"||a==="bool"?i.value.configuration[t]={key:t.toUpperCase(),type:"env",env_var_type:a}:a==="str"?i.value.configuration[t]={key:t.toUpperCase(),type:"env",env_var_type:a,default:""}:a==="json"?i.value.configuration[t]={key:t.toUpperCase(),type:"env",env_var_type:a,default:null}:i.value.configuration[t]={key:t.toUpperCase(),type:"env",env_var_type:a}}}f.value[g]=x}const F=r({availability:"none",latency:"none",security:"none",errors:"none"});function J(){const t=i.value?.contributions;t!==void 0&&(F.value=t)}const h=r([]);function O(){const t=i.value?.tags;t!==void 0?h.value=t:m.value?.manifest.metadata.labels!==void 0&&(h.value=m.value?.manifest.metadata.labels)}const ee=r([]),f=r([]);function R(){m.value?.manifest.spec.schema.configuration.forEach(t=>{t.required?t.default!==null&&t.default!==""?f.value.push(!0):f.value.push(!1):f.value.push(!0)})}const te=Ee(()=>!f.value.every(l=>l));async function ie(){i.value!==null&&(c.value!==null&&e.value===void 0&&A(i.value),i.value.contributions=F.value,i.value.tags=h.value,se({experiment:JSON.stringify(i.value)}))}function A(t){if(t.configuration!==void 0){const l=Object.keys(t.configuration),u=t["steady-state-hypothesis"],g=t.method,x=t.rollbacks,_=[];u!==void 0&&u.probes!==void 0&&u.probes.length&&_.push(u.probes[0]),g!==void 0&&g.length&&_.push(g[0]),x!==void 0&&x?.length&&_.push(x[0]),_.forEach(E=>{const a=E.provider.arguments;a!==void 0&&l.forEach(S=>{t.configuration[S].default===void 0&&(delete a[S],delete t.configuration[S])})})}}const V=r(!1);function ne(){V.value=!0}function oe(){V.value=!1}ye(async()=>{b.value=!0,v(),await W(),R(),N(),j(),L(),q(),J(),O(),b.value=!1});const I={isLoading:b,id:e,action:c,temp:m,experiment:i,getCurrentId:v,getTemplate:W,getExperimentFromTemplate:j,setMetaData:N,editTitle:C,experimentTitle:T,toggleEditTitle:B,getExperimentTitle:L,saveTitle:Y,editDescription:w,experimentDescription:D,toggleEditDescription:P,getExperimentDescription:q,saveDescription:Z,updateConfiguration:$,contributions:F,getExperimentContributions:J,tags:h,getExperimentTags:O,state:ee,requiredFieldsStatus:f,setRequiredFieldStatus:R,isSubmitDisabled:te,createExperiment:ie,postProcessExperiment:A,isExperimentDisplayed:V,displayExperimentModal:ne,closeExperimentModal:oe,CreateExperimentField:ue,ExperimentContributions:me,ExperimentTags:de,LoadingPlaceholder:ce,NoData:fe,ModalWindow:ve,JsonViewer:ge};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}}),Te={key:1,class:"experimentFromTemplate"},we={class:"pageHeader"},De={key:0},Fe={class:"pageHeader__title"},Ve={key:1},Se={class:"inputWrapper inputWrapper--wide"},ke={class:"experimentFromTemplate__intro"},Ue={class:"experimentFromTemplate__form"},Me={class:"experimentFromTemplate__info"},We={class:"experimentFromTemplate__infoWrapper experimentFromTemplate__infoWrapper--template"},je={key:0},Ne={key:1,class:"form"},Be={class:"inputWrapper inputWrapper--wide"},Le={class:"experimentConfiguration"},Pe={class:"form"},qe={class:"configurationFields list-reset"},Je={key:0},Oe={class:"inputWrapper inputWrapper--details"},Re={class:"experimentSave"},Ae=["disabled"],Ie={class:"experimentFormTemplate__preview"};function Ge(X,o,b,e,c,m){return s(),p(z,null,[e.isLoading?(s(),k(e.LoadingPlaceholder,{key:0,size:"large"})):e.temp!==void 0&&e.temp!==null&&e.temp.id!==void 0?(s(),p("article",Te,[n("header",we,[e.editTitle?(s(),p("div",Ve,[n("div",Se,[H(n("input",{type:"text",id:"experimentTitle","onUpdate:modelValue":o[0]||(o[0]=i=>e.experimentTitle=i)},null,512),[[G,e.experimentTitle]]),o[4]||(o[4]=n("label",{for:"experimentTitle",class:"screen-reader-text"}," Edit experiment title ",-1)),n("button",{class:"button button--creative button--small",onClick:d(e.saveTitle,["prevent"])}," Save "),n("button",{class:"button button--ghost button--small",onClick:d(e.toggleEditTitle,["prevent"])}," Cancel ")])])):(s(),p("div",De,[n("h1",Fe,U(e.temp.manifest.spec.template.title),1),n("button",{class:"button button--creative button--small",onClick:d(e.toggleEditTitle,["prevent"])}," Edit experiment title ")]))]),n("p",ke,[o[5]||(o[5]=M(" Fill the form with the requested information, to create a new experiment from the template ")),n("span",null,U(e.temp.manifest.metadata.name),1),o[6]||(o[6]=M(". "))]),n("div",Ue,[n("div",Me,[n("div",We,[e.editDescription?(s(),p("form",Ne,[n("div",Be,[H(n("textarea",{id:"experimentDescription","onUpdate:modelValue":o[1]||(o[1]=i=>e.experimentDescription=i)},null,512),[[G,e.experimentDescription]]),o[7]||(o[7]=n("label",{for:"experimentDescription",class:"screen-reader-text"}," Edit experiment description ",-1)),n("button",{class:"button button--creative button--small",onClick:d(e.saveDescription,["prevent"])}," Save "),n("button",{class:"button button--ghost button--small",onClick:d(e.toggleEditDescription,["prevent"])}," Cancel ")])])):(s(),p("div",je,[n("p",null,U(e.temp.manifest.spec.template.description),1),n("button",{class:"button button--creative button--small",onClick:d(e.toggleEditDescription,["prevent"])}," Edit description ")]))])]),n("div",null,[n("section",Le,[n("form",Pe,[n("ul",qe,[(s(!0),p(z,null,he(e.temp.manifest.spec.schema.configuration,(i,v)=>(s(),p("li",{class:"configurationField",key:v},[y(e.CreateExperimentField,{configuration:i,index:v,"force-internal":null,state:e.state,onUpdateConfiguration:e.updateConfiguration},null,8,["configuration","index","state"])]))),128)),e.temp.manifest.spec.schema.configuration.length===0?(s(),p("li",Je,o[8]||(o[8]=[n("strong",null," This activity doesn't require any configuration. ",-1)]))):K("",!0),n("li",null,[n("details",Oe,[o[9]||(o[9]=n("summary",null,"Contributions and tags",-1)),y(e.ExperimentContributions,{modelValue:e.contributions,"onUpdate:modelValue":o[2]||(o[2]=i=>e.contributions=i)},null,8,["modelValue"]),y(e.ExperimentTags,{modelValue:e.tags,"onUpdate:modelValue":o[3]||(o[3]=i=>e.tags=i)},null,8,["modelValue"])])])])])]),n("section",Re,[n("button",{onClick:d(e.createExperiment,["prevent"]),class:"button button--primary",disabled:e.isSubmitDisabled}," Save experiment ",8,Ae)])]),n("div",Ie,[n("button",{onClick:d(e.displayExperimentModal,["prevent"]),class:"button button--icon experimentFromTemplate__view hasTooltip hasTooltip--center-left","aria-label":"View Experiment",label:"View Experiment"}," { } ")])])])):(s(),k(e.NoData,{key:2,message:"We couldn't find an experiment with this ID."})),e.isExperimentDisplayed?(s(),k(e.ModalWindow,{key:3,isUnlimited:!0,hasCloseButton:!0,onClose:e.closeExperimentModal},{title:Q(()=>o[10]||(o[10]=[M("Experiment Definition")])),content:Q(()=>[y(e.JsonViewer,{json:JSON.stringify(e.experiment,null,2),"force-wrap":!0},null,8,["json"])]),_:1})):K("",!0)],64)}const Mt=pe(Ce,[["render",Ge],["__scopeId","data-v-93a1b138"]]);export{Mt as default};
