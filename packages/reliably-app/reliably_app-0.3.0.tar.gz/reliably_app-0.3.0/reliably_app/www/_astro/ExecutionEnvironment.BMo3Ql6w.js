import{h as K}from"./objects.CrQdKsRW.js";import{v as F,w as N}from"./runtime-dom.esm-bundler.DChKj6X8.js";import{C as M}from"./CheckIcon.Cp1OA8SI.js";import{E as X}from"./EditIcon.VtRJix1y.js";import{X as D}from"./XIcon.BeaDfJr1.js";import{e as O,o as z}from"./experiments.E3MiUWYx.js";import{a as j}from"./notifications.NSMm1_5U.js";/* empty css                      */import{_ as A}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{u as L}from"./index.CwJxcYEt.js";import{d as B,t as P,r as b,o as W,h as t,c as n,a as s,j as g,n as R,w as T,i as I,e as h,g as J,F as C,k as V,l as U}from"./runtime-core.esm-bundler.Y6RLDZTT.js";const q=B({__name:"ExecutionEnvironmentItem",props:{item:{},isEditable:{type:Boolean},experimentId:{}},setup(S,{expose:a}){a();const E=S,{item:e,isEditable:i,experimentId:x}=P(E),o=L(O),l=b(!1),k=b(!1),f=b(""),u=b(""),v=b(!1);function m(){l.value=!0}function _(){v.value=!1,l.value=!1,u.value=f.value}async function r(){if(k.value=!0,o.value?.id===x?.value){let c=JSON.parse(JSON.stringify(o.value?.definition));const y=c.configuration[e.value.key];if(y.default){if(y.env_var_type==="str"||y.env_var_type==="string")c.configuration[e.value.key].default=u.value;else if(y.env_var_type==="int"){const d=parseInt(u.value);Number.isNaN(d)?(v.value=!0,j({title:"Wrong configuration type",message:"Expected value is an integer.",type:"error"})):c.configuration[e.value.key].default=d}else if(y.env_var_type==="float"||y.env_var_type==="number"){const d=parseFloat(u.value);Number.isNaN(d)?(v.value=!0,j({title:"Wrong configuration type",message:"Expected value is an float.",type:"error"})):c.configuration[e.value.key].default=d}else if(y.env_var_type==="bool")u.value==="true"?c.configuration[e.value.key].default=!0:u.value==="false"?c.configuration[e.value.key].default=!1:(v.value=!0,j({title:"Wrong configuration type",message:"Expected value is a boolean. Please type 'true' or 'false'.",type:"error"}));else if(y.env_var_type==="json")try{const d=JSON.parse(u.value);c.configuration[e.value.key].default=d}catch{v.value=!0,j({title:"Wrong configuration type",message:"Expected value is a JSON object. Please provide a valid JSON object.",type:"error"})}}else c.configuration[e.value.key]=u.value;v.value||(await z(x.value,{experiment:JSON.stringify(c)},!0),f.value=u.value,l.value=!1)}else j({title:"Experiment couldn't be saved",message:"We couldn't find the experiment you're trying to edit. Please reload the page and try again.",type:"error"});k.value=!1}W(()=>{i&&i.value&&(f.value=e.value.value,(o.value?.definition.configuration[e.value.key]).env_var_type==="json"?u.value=JSON.stringify(f.value):u.value=f.value)});const p={props:E,item:e,isEditable:i,experimentId:x,exp:o,isEditing:l,isSaving:k,currentValue:f,newValue:u,hasError:v,openEdit:m,cancelEdit:_,saveEdit:r,CheckIcon:M,EditIcon:X,XIcon:D,get experiment(){return O}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),G={class:"executionEnvironmentItem"},H={class:"jsonString jsonString--envvar"},Q={key:2,class:"jsonString"};function Y(S,a,E,e,i,x){return t(),n("li",G,[s("div",H,g(e.item.key),1),s("div",null,[e.isEditing?(t(),n("div",{key:0,class:R(["jsonString editor",{"editor--saving":e.isSaving}])},[T(s("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=o=>e.newValue=o)},null,512),[[F,e.newValue]]),s("button",{onClick:N(e.cancelEdit,["prevent"]),class:"button button--icon"},[I(e.XIcon),a[1]||(a[1]=s("span",{class:"screen-reader-text"},"Cancel",-1))]),s("button",{onClick:N(e.saveEdit,["prevent"]),class:"button button--icon"},[I(e.CheckIcon),a[2]||(a[2]=s("span",{class:"screen-reader-text"},"Save",-1))])],2)):e.isEditable&&e.experiment&&!e.isEditing?(t(),n("div",{key:1,class:"jsonString",role:"button",onClick:N(e.openEdit,["prevent"])},g(e.currentValue),1)):(t(),n("div",Q,g(e.item.value),1))]),s("div",null,[e.isEditable&&e.experiment&&!e.isEditing?(t(),n("button",{key:0,onClick:N(e.openEdit,["prevent"]),class:"button button--icon"},[I(e.EditIcon),a[3]||(a[3]=s("span",{class:"screen-reader-text"},"Edit",-1))])):h("",!0)])])}const Z=A(q,[["render",Y]]),$=B({__name:"ExecutionEnvironment",props:{env:{},conf:{},isEditable:{type:Boolean},experiment:{}},setup(S,{expose:a}){a();const E=S,{env:e,conf:i,isEditable:x,experiment:o}=P(E),l=b([]);function k(){if(i&&i.value)Object.keys(i.value).filter(r=>r!=="reliably_url").forEach(r=>{if(typeof i.value[r]=="string")l.value.push({key:r,value:i.value[r]});else if(typeof i.value[r]=="number")l.value.push({key:r,value:i.value[r].toString()});else if(Array.isArray(i.value[r])){const p=i.value[r].join(", ");l.value.push({key:r,value:`[${p}]`})}else K(i.value[r],"key")?l.value.push({key:r,value:i.value[r].default}):l.value.push({key:r,value:i.value[r]})}),l.value.sort((r,p)=>r.key.localeCompare(p.key));else return[]}const f=J(()=>e?.value?.envvars.length?e.value.envvars.sort((m,_)=>m.var_name.localeCompare(_.var_name)):[]),u=J(()=>e?.value?.secrets.length?e.value.secrets.sort((m,_)=>{let r=m.var_name?m.var_name:m.path,p=_.var_name?_.var_name:_.path;return r.localeCompare(p)}):[]);W(()=>{k()});const v={props:E,env:e,conf:i,isEditable:x,experiment:o,configurationArray:l,buildConfigurationArray:k,sortedVars:f,sortedSecrets:u,ExecutionEnvironmentItem:Z};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),ee={class:"executionEnvironment"},te={key:0,class:"executionEnvironment__variables"},ne={key:0,class:"list-reset"},re={class:"jsonString jsonString--envvar"},ae={class:"jsonString"},ie={key:1},oe={key:1,class:"executionEnvironment__secrets"},se={key:0,class:"list-reset"},le={key:0,class:"jsonString jsonString--envvar"},ue={key:1,class:"jsonString jsonString--envvar"},ve={class:"jsonString"},ce={key:1},de={key:2,class:"executionEnvironment__configuration"},fe={key:0,class:"list-reset"},me={key:1},_e=["href"];function pe(S,a,E,e,i,x){return t(),n(C,null,[s("dl",ee,[e.env?(t(),n("div",te,[a[0]||(a[0]=s("dt",null,"Variables",-1)),s("dd",null,[e.env&&e.sortedVars.length?(t(),n("ul",ne,[(t(!0),n(C,null,V(e.sortedVars,(o,l)=>(t(),n("li",{key:l},[s("div",re,g(o.var_name),1),s("div",ae,g(o.value),1)]))),128))])):(t(),n("p",ie,"-"))])])):h("",!0),e.env?(t(),n("div",oe,[a[1]||(a[1]=s("dt",null,"Secrets",-1)),s("dd",null,[e.env&&e.sortedSecrets.length?(t(),n("ul",se,[(t(!0),n(C,null,V(e.sortedSecrets,(o,l)=>(t(),n("li",{key:l},[o.path?(t(),n("div",le,g(o.path),1)):o.var_name?(t(),n("div",ue,g(o.var_name),1)):h("",!0),s("div",ve,g(o.value),1)]))),128))])):(t(),n("p",ce,"-"))])])):h("",!0),e.conf?(t(),n("div",de,[a[2]||(a[2]=s("dt",null,null,-1)),s("dd",null,[e.conf&&e.configurationArray.length?(t(),n("ul",fe,[(t(!0),n(C,null,V(e.configurationArray,(o,l)=>(t(),U(e.ExecutionEnvironmentItem,{key:l,item:o,"is-editable":e.isEditable,"experiment-id":e.experiment},null,8,["item","is-editable","experiment-id"]))),128))])):(t(),n("p",me,"-"))])])):h("",!0)]),e.env?(t(),n("a",{key:0,href:`/environments/view/?id=${e.env.id}`,class:"executionEnvironment__link"}," View environment details ",8,_e)):h("",!0)],64)}const Ie=A($,[["render",pe],["__scopeId","data-v-ce3471c0"]]);export{Ie as E};
