import{v as H,w as f}from"./runtime-dom.esm-bundler.DChKj6X8.js";import{u as me}from"./index.DUHDLdXK.js";import{o as N,m as J,a as pe,s as fe,e as ve}from"./user.Bg1Nd46A.js";import{u as m}from"./index.CwJxcYEt.js";import{h as S}from"./user.BEEfOshe.js";import{i as D,d as z}from"./loader.BQDlK3Tc.js";import{a as v}from"./notifications.NSMm1_5U.js";import{a as _e}from"./index.BSdFiPHn.js";/* empty css                              */import{_ as O}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as j,t as Q,r as c,h as u,c as R,a as s,j as x,w as Z,F as ee,l as P,e as B,m as X,b as te,i as ge,k as ye,g as q,o as be}from"./runtime-core.esm-bundler.Y6RLDZTT.js";import{M as we}from"./ModalWindow.Go1bYN-e.js";import{D as ke}from"./DeleteButton.Ch6PF2gM.js";import{P as he}from"./Pager.Cmasf88E.js";import"./CloseIcon.DLOPA8gH.js";/* empty css                        */import"./TrashIcon.BzGEjUcP.js";/* empty css                       */m(N);const Le=J({org_id:null,subscription:null,plan:{name:"free",remaining:{executions:0,experiments:0,minutes:0,members:0}},state:"empty"}),Ue={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,PUBLIC_API_URL:"/api",SITE:void 0,SSR:!1},h=Ue===void 0?"https://62ff903e9350a1e548e1952e.mockapi.io/api":"/api",Re=h==="https://62ff903e9350a1e548e1952e.mockapi.io/api",xe=Re?"&limit=10":"",d=m(N),_=J({page:0,users:[],total:0,state:"empty"});async function Pe(o){return _.set(o),_.get()}const ne=async o=>{D();const t=`${h}/organization/${d.value}/users?page=${o}${xe}`;try{const n=await fetch(t);if(n.status===403)S(d.value);else if(n.ok){const e=await n.json();let a={page:o,users:e.items,total:e.count,state:"ready"};Pe(a)}else throw new Error(n.statusText)}catch(n){const e={title:"Users couldn't be fetched",message:n.message,type:"error"};v(e),_.setKey("state","error")}finally{z()}},Ce=async(o,t)=>{D();const n=`${h}/organization/${d.value}/users/${o}`;try{const e=await fetch(n,{method:"DELETE"});if(e.status===403)S(d.value);else if(e.ok){const a={title:"User was successfully removed",message:`${t} is not a member of your organization anymore.`,type:"success"};v(a)}else throw new Error(e.statusText)}catch(e){const a={title:"User couldn't be removed",message:e.message,type:"error"};v(a)}finally{z()}},T=_e({link:null,state:"empty"});async function C(o){return T.set(o),T.get()}const Se=async()=>{D();const o=`${h}/organization/${d.value}/invite`;try{const t=await fetch(o);if(t.status===403)S(d.value);else if(t.status===429)C({link:"Organizations on a Free plan can't invite additional team members",state:"ready"});else if(t.ok){const n=await t.json();if(n.link!==null){const e=window.location.protocol,a=window.location.host;let r={link:`${e}//${a}/join/?invite=${n.link}`,state:"ready"};C(r)}else se()}else throw new Error(t.statusText)}catch(t){const n={title:"Invitation link couldn't be fetched",message:t.message,type:"error"};v(n),_.setKey("state","error")}finally{z()}},se=async()=>{D();const o=`${h}/organization/${d.value}/invite/generate`;try{const t=await fetch(o);if(t.status===403)S(d.value);else if(t.status===429)C({link:"Organizations on a Free plan can't invite additional team members",state:"ready"});else if(t.ok){const n=await t.json(),e=window.location.protocol,a=window.location.host;let r={link:`${e}//${a}/join/?invite=${n.link}`,state:"ready"};C(r)}else throw new Error(t.statusText)}catch(t){const n={title:"Invitation link couldn't be created",message:t.message,type:"error"};v(n),_.setKey("state","error")}finally{z()}},De=j({__name:"ConfirmRemoveUser",props:{user:{}},emits:["close"],setup(o,{expose:t,emit:n}){t();const e=o,{user:a}=Q(e),r=c(""),i=n,y={props:e,user:a,confirmation:r,emit:i,cancel:()=>{i("close")},proceed:async()=>{await Ce(a.value.id,a.value.username),await ne(),i("close")}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),ze={class:"form"},Ie={class:"inputWrapper"},Me={class:"inputWrapper"},Ee=["disabled"];function $e(o,t,n,e,a,r){return u(),R(ee,null,[s("p",null," You are about to remove user "+x(e.user.username)+" from your organization. ",1),s("p",null,"Type '"+x(e.user.username)+"' to proceed.",1),s("form",ze,[s("div",Ie,[t[1]||(t[1]=s("label",{for:"confirmDelete"},null,-1)),Z(s("input",{type:"text",id:"confirmDelete",name:"confirmDelete","onUpdate:modelValue":t[0]||(t[0]=i=>e.confirmation=i)},null,512),[[H,e.confirmation]])]),s("div",Me,[s("button",{onClick:f(e.cancel,["prevent"]),class:"button"},"Cancel"),s("button",{onClick:f(e.proceed,["prevent"]),class:"button button--destructive",disabled:e.confirmation!==e.user.username}," Remove ",8,Ee)])])],64)}const Be=O(De,[["render",$e],["__scopeId","data-v-3184e005"]]),Te=j({__name:"UserPreview",props:{user:{},isRemovable:{type:Boolean}},setup(o,{expose:t}){t();const n=o,{user:e}=Q(n),a=c(!1);function r(){a.value=!0}function i(){a.value=!1}const p={props:n,user:e,isRemoveDisplayed:a,displayRemoveModal:r,closeRemoveModal:i,ConfirmRemoveUser:Be,ModalWindow:we,DeleteButton:ke};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),Ne={class:"tableList__row userPreview"},Oe={class:"tableList__cell"},je={class:"tableList__cell tableList__cell--small"};function Ve(o,t,n,e,a,r){return u(),R("li",Ne,[s("div",Oe,x(e.user.username),1),s("div",je,[n.isRemovable?(u(),P(e.DeleteButton,{key:0,type:"user",onClick:f(e.displayRemoveModal,["prevent"])})):B("",!0)]),e.isRemoveDisplayed?(u(),P(e.ModalWindow,{key:0,hasCloseButton:!0,hasPadding:!0,onClose:e.closeRemoveModal},{title:X(()=>t[0]||(t[0]=[te("Remove User")])),content:X(()=>[ge(e.ConfirmRemoveUser,{user:e.user,onClose:e.closeRemoveModal},null,8,["user"])]),_:1})):B("",!0)])}const Ae=O(Te,[["render",Ve],["__scopeId","data-v-2f844638"]]),Fe=j({__name:"BillingInfo",setup(o,{expose:t}){t();const n=m(N),e=m(pe),a=m(Le),r=c(!1),i=c(!1),p=m(_),g=c(1),y=c(null),V=c({currentPage:1,lastPage:1,urlBase:""});async function A(){await ne(g.value),y.value.scrollIntoView(!0)}const F=()=>{let b={currentPage:g.value,lastPage:Math.ceil(p.value.total/10),urlBase:"/settings/organization/?users="};V.value=b},G=q(()=>a.value.plan.name==="free"),I=m(T),L=c(""),{text:ae,copy:W,copied:oe,isSupported:ie}=me(),re=()=>{G.value||(W(L.value),v({title:"Invitation link copied to clipboard",message:"Your invitation link has been copied to your clipboard. Go invite some teammates!",type:"success"}))};async function le(){await se(),M()}function M(){I.value.link===null?L.value="":L.value=I.value.link}async function K(){let b=window.location,l=new URLSearchParams(b.search),w="",$="",k="";l.has("plan")&&(U.value=!0,E.value=l.get("plan")),l.has("success")&&(w=l.get("success")),l.has("org")&&($=l.get("org")),l.has("orgid")&&(k=l.get("orgid")),l.has("users")&&(g.value=parseInt(l.get("users"))),w!==""&&$!==""&&k!==""&&(n.value!==k?(await ve(k),b.replace(`/settings/organization/?success=${w}&orgid=${k}&org=${$}`)):w==="true"?r.value=!0:w==="false"&&(i.value=!0))}const U=c(!1),E=c("");function ce(){U.value=!0}function ue(){U.value=!1}const de=q(()=>E.value!==""?"Configure your new Reliably organization":a.value.plan.name==="free"?"Switch to a paid plan":"Upgrade your plan");be(async()=>{await K(),e.value===""&&await fe(),await A(),F(),await Se(),M()});const Y={currentOrganizationId:n,currentOrganizationName:e,currentSub:a,isSuccessDisplayed:r,isFailDisplayed:i,usersList:p,usersPage:g,billingUsers:y,pagerData:V,getUsers:A,getpagerData:F,areInvitationsDisabled:G,invitation:I,link:L,text:ae,copy:W,copied:oe,isSupported:ie,copyLink:re,generateNewLink:le,updateDisplayedLink:M,handleURLParams:K,isModalDisplayed:U,preSelectedPlan:E,displayModal:ce,closeModal:ue,modalTitle:de,UserPreview:Ae,Pager:he};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}}),Ge={class:"billing"},We={class:"billingCurrent"},Ke={class:"billingUsers",ref:"billingUsers"},Ye={class:"usersList tableList"},Xe={class:"invitationLink"},qe={class:"invitationLink__wrapper"},He={class:"invitationLink__link"},Je={class:"invitationLink__new"};function Qe(o,t,n,e,a,r){return u(),R("div",Ge,[s("section",We,[s("p",null,[t[2]||(t[2]=te(" Your organization is ")),s("strong",null,x(e.currentOrganizationName),1)])]),s("section",Ke,[t[4]||(t[4]=s("h2",null,"Team Members",-1)),s("ul",Ye,[t[3]||(t[3]=s("li",{class:"tableList__row tableList__row--header"},[s("div",{class:"tableList__cell"},"Username"),s("div",{class:"tableList__cell"},[s("span",{class:"screen-reader-text"},"Actions")])],-1)),(u(!0),R(ee,null,ye(e.usersList.users,i=>(u(),P(e.UserPreview,{user:i,isRemovable:e.usersList.users.length>1,key:i.id},null,8,["user","isRemovable"]))),128))]),e.usersList.total>10?(u(),P(e.Pager,{key:0,page:e.pagerData},null,8,["page"])):B("",!0)],512),s("section",Xe,[t[7]||(t[7]=s("h2",null,"Invitation Link",-1)),s("div",qe,[s("div",He,[Z(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>e.link=i),readonly:"",onClick:f(e.copyLink,["prevent"])},null,512),[[H,e.link]]),s("button",{class:"button button--primary",onClick:f(e.copyLink,["prevent"])}," Copy to clipboard ")]),s("div",Je,[t[5]||(t[5]=s("h3",null,"Generate a new link",-1)),t[6]||(t[6]=s("p",null," Generating a new link will disable the existing link. Members who joined using this link will remain in your organization, but no new members will be able to join with the disabled link. ",-1)),s("button",{class:"button button--creative",onClick:t[1]||(t[1]=f(i=>e.generateNewLink(),["prevent"]))}," Generate new link ")])])])])}const gt=O(Fe,[["render",Qe]]);export{gt as default};
