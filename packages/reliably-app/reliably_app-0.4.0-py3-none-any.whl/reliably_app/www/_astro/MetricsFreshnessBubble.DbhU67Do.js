import{w as F}from"./runtime-dom.esm-bundler.DChKj6X8.js";import{C as W,B as q}from"./index.B8cAO9n_.js";import{m as H,l as J}from"./series.kU8HocMx.js";import{L as K}from"./LoadingPlaceholder.BoWrztnb.js";/* empty css                       */import{_ as Q}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{u as U}from"./index.CwJxcYEt.js";import{d as X,c as S,a as I,n as A,l as M,e as N,r as o,g as Y,p as Z,o as $,h as _}from"./runtime-core.esm-bundler.Y6RLDZTT.js";import"./user.Bg1Nd46A.js";import"./index.BSdFiPHn.js";import"./loader.BQDlK3Tc.js";import"./notifications.NSMm1_5U.js";import"./contributions.K_0J8Jft.js";import"./objects.CrQdKsRW.js";import"./user.BEEfOshe.js";import"./dayjs.min.xlbmdZiw.js";/* empty css                       */const ee=X({__name:"MetricsFreshnessBubble",setup(R,{expose:u}){u();const{Chart:C,Tooltip:s,Legend:k,PointElement:D,LinearScale:x}=W;C.register(s,s,k,D,x);const B=o(!0),E=o(!1),m=o(!1),g=o(!1),L=Y(()=>m.value||g.value),c=U(H),b=o({labels:[],datasets:[{label:"A",data:[],backgroundColor:"hsl(120, 42%, 53%)"},{label:"B",data:[],backgroundColor:"hsl(56, 91%, 49%)"},{label:"C",data:[],backgroundColor:"rgb(255, 165, 0)"},{label:"D",data:[],backgroundColor:"rgb(255, 60, 88)"}]}),d=o([[],[],[],[]]),f=o([[],[],[],[]]),v=o({labels:[],datasets:[{label:"A",data:[],backgroundColor:"hsl(120, 42%, 53%)"},{label:"B",data:[],backgroundColor:"hsl(56, 91%, 49%)"},{label:"C",data:[],backgroundColor:"rgb(255, 165, 0)"},{label:"D",data:[],backgroundColor:"rgb(255, 60, 88)"}]}),h=o([[],[],[],[]]),p=o([[],[],[],[]]);async function P(){await J()}function w(){if(E.value=!0,c.value.distributions.scores.per_experiment.length>0&&(m.value=!0),c.value.distributions.scores.per_plan.length>0&&(g.value=!0),L.value){const t=c.value.distributions.scores.per_experiment,a=c.value.distributions.scores.per_plan;let r=0,n=0;t.forEach(e=>{e.execution_count>r&&(r=e.execution_count)}),a.forEach(e=>{e.execution_count>n&&(n=e.execution_count)}),m.value&&t.forEach(e=>{e.score>=.9?(b.value.datasets[0].data.push({x:e.freshness,y:e.score,r:i(e.execution_count,r)}),d.value[0].push(e.experiment_title),f.value[0].push(e.execution_count)):e.score>=.7?(b.value.datasets[1].data.push({x:e.freshness,y:e.score,r:i(e.execution_count,r)}),d.value[1].push(e.experiment_title),f.value[1].push(e.execution_count)):e.score>=.5?(b.value.datasets[2].data.push({x:e.freshness,y:e.score,r:i(e.execution_count,r)}),d.value[2].push(e.experiment_title),f.value[2].push(e.execution_count)):(b.value.datasets[3].data.push({x:e.freshness,y:e.score,r:i(e.execution_count,r)}),d.value[3].push(e.experiment_title),f.value[3].push(e.execution_count))}),g.value&&a.forEach(e=>{const l=e.plan_title?e.plan_title:e.plan_id;e.score>=.9?(v.value.datasets[0].data.push({x:e.freshness,y:e.score,r:2*e.execution_count}),h.value[0].push(l),p.value[0].push(e.execution_count)):e.score>=.7?(v.value.datasets[1].data.push({x:e.freshness,y:e.score,r:i(e.execution_count,n)}),h.value[1].push(l),p.value[1].push(e.execution_count)):e.score>=.5?(v.value.datasets[2].data.push({x:e.freshness,y:e.score,r:i(e.execution_count,n)}),h.value[2].push(l),p.value[2].push(e.execution_count)):(v.value.datasets[3].data.push({x:e.freshness,y:e.score,r:i(e.execution_count,n)}),h.value[3].push(l),p.value[3].push(e.execution_count))})}E.value=!1}Z(c,()=>w());const y=o("experiment");function z(t){y.value=t}const G=o({responsive:!0,maintainAspectRatio:!1,pointRadius:6,scales:{x:{title:{display:!0,text:"Freshness"},suggestedMin:-10,suggestedMax:110,ticks:{precision:0,stepSize:10,callback:function(t,a){return t===90?"Fresh":t===70?"Good":t===40?"Old":t===10?"Too old":""},font:{weight:"bold"},color:t=>{if(t.tick.label==="Fresh")return"hsl(124, 32%, 48%)";if(t.tick.label==="Good")return"hsl(56, 94%, 40%)";if(t.tick.label==="Old")return"rgb(255, 165, 0)";if(t.tick.label==="Too old")return"hsl(0, 79%, 40%)"}},afterDataLimits:t=>{t.max=100,t.min=0}},y:{title:{display:!0,text:"Score"},ticks:{precision:1,labelOffset:12,callback:function(t,a){if(t===1)return"A";if(t===.9)return"B";if(t===.7)return"C";if(t===.5)return"D"}},afterDataLimits:t=>{t.max=1,t.min=0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(t){const a=[],r=y.value==="experiment"?d.value:h.value;return t.forEach(n=>{const e=n.datasetIndex,l=n.dataIndex;a.push(r[e][l])}),a},label:function(t){const a=t.dataset.data[t.dataIndex],r=O(a.y),n=`${a.x.toString()}%`,e=y.value==="experiment"?f.value:p.value,l=t.datasetIndex,V=t.dataIndex,j=e[l][V].toString();return`Score: ${r}. Freshness: ${n}. Executions: ${j}`}}}}});function i(t,a){return t>.9*a?14:t>.8*a?13:t>.7*a?12:t>.6*a?11:t>.5*a?10:t>.4*a?9:t>.3*a?8:t>.2*a?7:t>.1*a?6:5}function O(t){return t>=.9?"A":t>=.7?"B":t>=.5?"C":"D"}$(async()=>{B.value=!0,await P(),B.value=!1});const T={Chart:C,Tooltip:s,Legend:k,PointElement:D,LinearScale:x,isMounting:B,isComputing:E,hasExperimentData:m,hasPlanData:g,hasData:L,storedData:c,experimentData:b,experimentTitles:d,experimentExecutions:f,planData:v,planTitles:h,planExecutions:p,getData:P,computeData:w,displayedChart:y,display:z,chartOptions:G,executionCountToRadius:i,scoreNumberToLetter:O,get Bubble(){return q},LoadingPlaceholder:K};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}}),te={class:"metricsScore"},se={class:"metricsScore__controls"},ae={key:1},oe={key:2,class:"metricsScore__wrapper"};function re(R,u,C,s,k,D){return _(),S("div",te,[I("div",se,[I("button",{onClick:u[0]||(u[0]=F(x=>s.display("experiment"),["prevent"])),class:A(["pill",{"pill--active":s.displayedChart==="experiment"}])}," Per experiment ",2),I("button",{onClick:u[1]||(u[1]=F(x=>s.display("plan"),["prevent"])),class:A(["pill",{"pill--active":s.displayedChart==="plan"}])}," Per plan ",2)]),s.isMounting||s.isComputing?(_(),M(s.LoadingPlaceholder,{key:0})):s.hasData?(_(),S("div",oe,[s.displayedChart==="experiment"?(_(),M(s.Bubble,{key:0,data:s.experimentData,options:s.chartOptions},null,8,["data","options"])):N("",!0),s.displayedChart==="plan"?(_(),M(s.Bubble,{key:1,data:s.experimentData,options:s.chartOptions},null,8,["data","options"])):N("",!0)])):(_(),S("p",ae,"We don't have this data yet."))])}const ke=Q(ee,[["render",re],["__scopeId","data-v-2bad5409"]]);export{ke as default};
